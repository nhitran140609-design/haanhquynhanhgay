<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz Game</title>
<style>
    body {
        margin: 0; padding: 0;
        display: flex; justify-content: center; align-items: center;
        height: 100vh; background: #f2f2f2; font-family: Arial;
    }
    canvas { background:#fff; border:2px solid #000; }
    #controls { text-align:center; margin-top:10px; }
</style>
</head>
<body>

<div>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div id="result" style="font-size:22px;font-weight:bold;height:30px"></div>

    <!-- Báº¡n tá»± thay file mp3 -->
    <audio id="correctSound" src="correct.mp3.mp4"></audio>
    <audio id="wrongSound" src="wrong.mp3.mp4"></audio>

    <div id="controls">
        <button id="musicBtn">ğŸµ Báº­t/Táº¯t nháº¡c</button>
        <button id="restartBtn">ğŸ” ChÆ¡i láº¡i</button>
        <p>Nháº¥n phÃ­m 1 - 4 Ä‘á»ƒ chá»n Ä‘Ã¡p Ã¡n</p>
    </div>
</div>

<script>
// Canvas
const c = document.getElementById("gameCanvas");
const ctx = c.getContext("2d");
const result = document.getElementById("result");

// Audio
const correct = document.getElementById("correctSound");
const wrong = document.getElementById("wrongSound");
const bg = document.getElementById("bgMusic");

// Images (auto fallback)
function loadImg(src){
    const img = new Image();
    img.src = src;
    img.onerror = () => img._fail = true;
    return img;
}
const neutral = loadImg("character_neutral.png.jfif");
const happy   = loadImg("character_happy.png.jfif");
const sad     = loadImg("character_sad.png.jfif");

// Questions
const q = [
{q:"Quá»‘c gia kiÃªn Ä‘á»‹nh CNXH?",a:["TQ, VN, Cuba, LÃ o","TQ, Nga, VN, Cam","VN, Cuba, HQ, LÃ o","Cuba, TQ, Cam, Nháº­t"],c:1},
{q:"Ai khá»Ÿi xÆ°á»›ng Ä‘á»•i má»›i TQ 1978?",a:["Mao","Äáº·ng","Giang","Táº­p"],c:2},
{q:"ThÃ nh tá»±u cáº£i cÃ¡châ†’ chá»©ng minh?",a:["CNXH cÃ³ sá»©c sá»‘ng","TBCN ko duy nháº¥t","CNXH má»Ÿ rá»™ng","CNXH toÃ n cáº§u"],c:1},
{q:"BÃ i há»c VN?",a:["TÆ° báº£n","Tá»± do","ChÃ­nh trá»‹ trÆ°á»›c","KTTT XHCN + má»Ÿ cá»­a"],c:4},
{q:"Má»¥c tiÃªu VN?",a:["DÃ¢n giÃ u nÆ°á»›c máº¡nh","PhÃ¡t triá»ƒn TBCN","CNH má»i giÃ¡","Giáº£m vai trÃ² NN"],c:1}
];

let i=0,score=0, state="neutral", anim=0, end=false;

// Draw function
function draw(){
    ctx.clearRect(0,0,800,600);

    // background
    if(!bgImg._fail) ctx.drawImage(bgImg,0,0,800,600);
    else {ctx.fillStyle="#ddd"; ctx.fillRect(0,0,800,600);}

    // character
    const img = state==="happy"?happy: state==="sad"?sad:neutral;
    const y = 150 + Math.sin(anim/10)*8;
    const s = 1 + Math.sin(anim/20)*0.03;

    ctx.save();
    ctx.translate(400,y);
    ctx.scale(s,s);
    if(!img._fail) ctx.drawImage(img,-75,-75,150,150);
    else {ctx.fillStyle="#888"; ctx.fillRect(-60,-60,120,120);} // fallback
    ctx.restore();

    // text
    ctx.fillStyle="#000";
    ctx.font="22px Arial";
    ctx.fillText(q[i].q,40,350);
    ctx.font="20px Arial";
    q[i].a.forEach((a,k)=>ctx.fillText(`${k+1}. ${a}`,60,390+k*35));
    ctx.fillText(`CÃ¢u ${i+1}/${q.length} | Äiá»ƒm: ${score}`,20,40);

    anim++;
    requestAnimationFrame(draw);
}
draw();

// Input
document.addEventListener("keydown",e=>{
    if(end) return;
    const k = +e.key;
    if(k>=1 && k<=4){
        if(k===q[i].c){ score++; state="happy"; correct.play(); result.textContent="âœ” Ä‘Ãºng!"; result.style.color="green"; }
        else { state="sad"; wrong.play(); result.textContent="âœ˜ sai!"; result.style.color="red"; }

        setTimeout(()=>{
            i++; result.textContent=""; state="neutral";
            if(i>=q.length){ end=true; alert(`âœ… HoÃ n thÃ nh! Äiá»ƒm: ${score}/${q.length}`);}
        },1000);
    }
});

// Buttons
document.getElementById("restartBtn").onclick = ()=>{ i=0;score=0;end=false;state="neutral"; };
let m = false;
document.getElementById("musicBtn").onclick=()=>{m=!m; if(m)bg.play(); else bg.pause();};
</script>

</body>
</html>
